!function(e,t){"function"==typeof define&&(define.amd||define.cmd)?define(t):e.Color=t()}(this,function(e){if("function"==typeof e)e("drop");else if(!$().drop)return window.console&&window.console.error("need Drop.js"),{};var p="coo-color-",s="#000000",u="active",y="background-color";$.hslToHex=function(e,t,o){var r,i,s;if(0==t)r=i=s=o;else{function a(e,t,o){return o<0&&(o+=1),1<o&&(o-=1),o<1/6?e+6*(t-e)*o:o<.5?t:o<2/3?e+(t-e)*(2/3-o)*6:e}var l=o<.5?o*(1+t):o+t-o*t,n=2*o-l;r=a(n,l,e+1/3),i=a(n,l,e),s=a(n,l,e-1/3)}var c=[Math.round(255*r),Math.round(255*i),Math.round(255*s)];return $.map(c,function(e){return 1==(e=e.toString(16)).length?"0"+e:e}).join("")},$.hexToHsl=function(e){var t,o,r=parseInt(e.slice(0,2),16)/255,i=parseInt(e.slice(2,4),16)/255,s=parseInt(e.slice(4,6),16)/255,a=Math.max(r,i,s),l=Math.min(r,i,s),n=(a+l)/2;if(a==l)t=o=0;else{var c=a-l;switch(o=.5<n?c/(2-a-l):c/(a+l),a){case r:t=(i-s)/c+(i<s?6:0);break;case i:t=(s-r)/c+2;break;case s:t=(r-i)/c+4}t/=6}return[t,o,n]},$.rgbToHex=function(e){if(!e)return s;var t=[];if(/^#[0-9A-F]{6}$/i.test(e))return e;if(/^#[0-9A-F]{3}$/i.test(e))return(t=e.split(""))[0]+t[1]+t[1]+t[2]+t[2]+t[3]+t[3];function o(e){return("0"+parseInt(e,10).toString(16)).slice(-2)}return 4==(t=e.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)/i)).length?"#"+o(t[1])+o(t[2])+o(t[3]):s},$.fn.colorpicker=function(e){return $(this).each(function(){$(this).data("color")||$(this).data("color",new t($(this),e))})};var t=function(e,t){var o=this,r={offsets:{x:0,y:0},edgeAdjust:!1,position:"7-5",onShow:$.noop,onHide:$.noop},i=$.extend({},r,t||{});if(e){e.size||(e=$(e));var s=e[0],a=s.id;a||(a="C"+(Math.random()+"").split(".")[1],s.id=a),e.prop("readonly",!0).on("click",function(e){e.preventDefault()});var l=$('<label for="'+a+'"></label>').addClass(p+"track"),n=$("<span></span>").addClass(p+"thumb");e.before(l.append(n));var c=$("<div></div>").addClass(p+"container");return e.drop(c,{eventType:"click",offsets:i.offsets,edgeAdjust:i.edgeAdjust,position:i.position,onShow:function(){if(o.show(),0==i.edgeAdjust){var e=c[0].getBoundingClientRect();e.left<3?c.css("margin-left",-1*e.left+3):3<e.right-$(window).width()&&c.css("margin-left",$(window).width()-e.right-3)}},onHide:function(){o.hide(),c.css("margin-left","0")}}),e.on("focus",function(){window.isKeyEvent&&l.addClass("ui-outline")}).blur(function(){l.removeClass("ui-outline")}),o.drop=e.data("drop"),this.el={input:e,container:c,track:l,thumb:n},this.callback={show:i.onShow,hide:i.onHide},this.value(s.value),this}};return t.prototype.value=function(e){var t=this,o=t.el.input,r=t.el.thumb,i=o.val();return"string"!=typeof e?(i||(i=s,o.val(i),r.css(y,i)),i):(e=$.rgbToHex(e),o.val(e),r.css(y,e),t.match(),i&&e!=i&&o.trigger("change"),this)},t.prototype.create=function(){var t,s,e=this.el.container,o='<div class="'+p+'body">'+('<div class="'+p+'basic colorBasicX" role="listbox">'+'<div class="'+p+'basic-l">'+$.map(["0","3","6","9","C","F","F00","018001","0501ff","FF0","0FF","800180"],function(e){return 1==(e=e.toUpperCase()).length?e=e+e+e+e+e+e:3==e.length&&(e=e.replace(/\w/g,function(e){return e+e})),'<a href="javascript:" class="'+p+'lump" data-color="'+e+'" aria-label="'+e+'" style="'+y+":#"+e+'" role="option"></a>'}).join("")+"</div>"+'<div class="'+p+'basic-r">'+(t=["0","3","6","9","C","F"],s="",$.each(t,function(e,i){s+='<div class="'+p+'lump-group">',$.each(t,function(e,r){$.each(t,function(e,t){var o=i+i+r+r+t+t;s=s+'<a href="javascript:" class="'+p+'lump" data-color="'+o+'" style="'+y+":#"+o+'" aria-label="'+o+'" role="option"></a>'})}),s+="</div>"}),s)+"</div>"+"</div>")+('<div class="'+p+'more colorMoreX">'+'<div class="'+p+'more-l">                <a href="javascript:" class="'+p+'cover-white" aria-label="色域背景块" role="region"></a><div class="'+p+'circle colorCircle"></div>                <svg>                    <defs>                        <linearGradient x1="0" y1="0" x2="1" y2="0" id="colorGradient">                            <stop offset="0%" stop-color="#ff0000"></stop>                            <stop offset="16.66%" stop-color="#ffff00"></stop>                            <stop offset="33.33%" stop-color="#00ff00"></stop>                            <stop offset="50%" stop-color="#00ffff"></stop>                            <stop offset="66.66%" stop-color="#0000ff"></stop>                            <stop offset="83.33%" stop-color="#ff00ff"></stop>                            <stop offset="100%" stop-color="#ff0000"></stop>                        </linearGradient>                    </defs>                    <rect x="0" y="0" width="180" height="100" fill="url(#colorGradient)"></rect>                </svg></div><div class="'+p+'more-r">                    <div class="'+p+'more-fill colorFill">                        <a href="javascript:" class="'+p+'more-cover" aria-label="明度控制背景条" role="region"></a>                        <svg>                        <defs>                            <linearGradient x1="0" y1="0" x2="0" y2="1" id="colorGradient2">                                <stop offset="0%" stop-color="#ffffff"></stop>                                <stop offset="50%" stop-color="rgba(255,255,255,0)"></stop>                                <stop offset="50%" stop-color="rgba(0,0,0,0)"></stop>                                <stop offset="100%" stop-color="#000000"></stop>                            </linearGradient>                        </defs>                        <rect x="0" y="0" width="16" height="100" fill="url(#colorGradient2)"></rect>                    </svg>                    </div>                    <a href="javascript:" class="'+p+'more-arrow colorArrow" role="slider" aria-label="明度控制按钮：100%"></a>                </div>'+"</div>")+"</div>";return e.html('<a href="javascript:" class="coo-color-switch" role="button">更多</a><div class="coo-color-current">            <i class="coo-color-current-square colorCurrent"></i>            #<input class="coo-color-current-input">        </div>'+o+'<div class="coo-color-footer">            <a href="javascript:" class="coo-color-btn-cancel">取消</a><a href="javascript:" class="coo-color-btn-ensure">确定</a>        </div>'),$.extend(this.el,{field:e.find("input"),basic:e.find(".colorBasicX"),more:e.find(".colorMoreX"),circle:e.find(".colorCircle"),fill:e.find(".colorFill"),arrow:e.find(".colorArrow"),current:e.find(".colorCurrent")}),this.events(),this},t.prototype.events=function(){var h=this,e=h.el.container,u=h.el.circle,v=h.el.fill,g=h.el.arrow,m=h.el.field;e.on("click","a",function(e){var t=this,o=$(t),r="",i=t.className;if(/cancel/.test(i))h.hide();else if(/ensure/.test(i))(r=m.val())&&h.value("#"+r),h.hide();else if(/lump/.test(i))r=o.attr("data-color"),m.val(r),h.match();else if(/switch/.test(i))"更多"==t.innerHTML?(h.el.more.show(),h.el.basic.hide(),t.innerHTML="基本"):(h.el.more.hide(),h.el.basic.show(),t.innerHTML="更多"),h.match();else if(/cover/.test(i)){var s,a,l=t.getBoundingClientRect(),n=e.pageX-l.left,c=e.pageY-$(document).scrollTop()-l.top,p=t.clientWidth,f=t.clientHeight;if(u.length&&v.length&&g.length){if(1==/white/.test(i)){s=n/p,a=1-c/f,u.css({left:n,top:c});var d="hsl("+[360*s,100*a+"%","50%"].join()+")";u.css(y,d)}else g.css("top",c);m.val(h._getHSL().replace("#","")),h.match()}}});var t=h.el.field;if(t.on("input",function(){var e=this.value;/^[0-9A-F]{6}$/i.test(e)?h.match():/^[0-9A-F]{3}$/i.test(e)&&h.match($.rgbToHex("#"+e).replace("#",""))}).on("keyup",function(e){if(13==e.keyCode){var t=m.val(),o=t;t&&((t=$.rgbToHex("#"+t))!=o&&m.val(t),h.value("#"+t)),h.hide()}}),[].map){var r={};g.on("mousedown",function(e){r.pageY=e.pageY,r.top=1*g.css("top").replace("px",""),e.preventDefault()}),document.addEventListener("mousemove",function(e){if("number"==typeof r.top){var t=r.top+(e.pageY-r.pageY),o=g.parent().height();t<0?t=0:o<t&&(t=o),g.css("top",t),m.val(h._getHSL().replace("#","")),h.match(!1)}}),document.addEventListener("mouseup",function(){r.top=null}),v.parent().find("a").on("keydown",function(e){if(38==e.keyCode||40==e.keyCode){e.preventDefault();var t=1*g.css("top").replace("px",""),o=v.height();38==e.keyCode?--t<0&&(t=0):o<++t&&(t=o);var r=g.attr("aria-label");g.css("top",t).attr("aria-label",r.replace(/\d+/,Math.round(100*t/o))),m.val(h._getHSL().replace("#","")),h.match(!1)}}),u.parent().find("a").on("keydown",function(e){var t=$(this);if(37<=e.keyCode&&e.keyCode<=40){e.preventDefault();var o=1*u.css("top").replace("px",""),r=1*u.css("left").replace("px",""),i=t.height(),s=t.width();38==e.keyCode?--o<0&&(o=0):40==e.keyCode?i<++o&&(o=i):37==e.keyCode?--r<0&&(r=0):39==e.keyCode&&s<++r&&(r=s);var a=r/s,l=1-o/i;u.css({left:r,top:o});var n="hsl("+[360*a,100*l+"%","50%"].join()+")";u.css(y,n),m.val(h._getHSL().replace("#","")),h.match()}})}else t[0].attachEvent("onpropertychange",function(e){(e=e||window.event)&&"value"==e.propertyName&&t.trigger("input")});return h},t.prototype._getHSL=function(){var e,t,o,r=this.el.circle,i=this.el.arrow;return r.length*i.length==0?this:(e=r[0].style.left?r.css("left").replace("px","")/r.parent().width():0,t=r[0].style.top?1-r.css("top").replace("px","")/r.parent().height():1,o=i[0].style.top?1-i.css("top").replace("px","")/i.parent().height():0,"#"+$.hslToHex(e,t,o))},t.prototype.match=function(e){var t=this;if(1!=t.display)return this;var o,r,i,s=t.el.container,a=t.el.current,l=t.el.field,n=!0;if(!1===e&&(n=e),""==(e=e||l.val())&&(e=$.rgbToHex(a.css(y)).replace("#",""),l.val(e)),e=e.replace("#",""),a.css(y,"#"+e),"none"==t.el.more.css("display"))s.find("."+u).removeClass(u),s.find('a[data-color="'+e.toUpperCase()+'"]').addClass(u);else{o=t.el.circle,r=t.el.fill,i=t.el.arrow;var c=$.hexToHsl(e),p=c[0],f=c[1],d=c[2],h="hsl("+[360*p,100*f+"%","50%"].join()+")";"000000"!=e&&(o.css(y,h),r.css(y,h)),1==n&&(0!=d&&o.css({left:o.parent().width()*p,top:o.parent().height()*(1-f)}),i.css("top",i.parent().height()*(1-d)))}return this},t.prototype.show=function(){var e=this,t=e.el.container;""==t.html()&&e.create(),0==e.drop.display&&e.drop.show(),e.display=e.drop.display;var o=e.el.current;return o.attr("style")||o.css(y,e.el.input.val()),e.match(),$.isFunction(this.callback.show)&&this.callback.show.call(this,this.el.track,t),this},t.prototype.hide=function(){var e=this;return 1==e.drop.display&&e.drop.hide(),e.display=e.drop.display,e.el.input.focus(),$.isFunction(this.callback.hide)&&this.callback.hide.call(this,this.el.trigger,this.el.container),this},t});