!function(t,a){"function"==typeof define&&(define.amd||define.cmd)?define(a):t.Datalist=a()}(this,function(t){if("function"==typeof t)t("follow");else if(!$().follow)return window.console&&window.console.error("need Follow.js"),{};var c="datalist",o="selected",e="active",i="reverse",u="coo-datalist";$.stripHTML=function(t){return"string"==typeof t?t.replace(/<\/?[^>]*>/g,""):""},$.encodeHTML=function(t){return"string"==typeof t?t.replace(/<|&|>/g,function(t){return{"<":"&lt;",">":"&gt;","&":"&amp;"}[t]}):""},$.decodeHTML=function(t){return"string"==typeof t?t.replace(/&lt;|&gt;|&amp;/g,function(t){return{"&lt;":"<","&gt;":">","&amp;":"&"}[t]}):""},$.fn.datalist=function(t){return $(this).each(function(){$(this).data(c)||$(this).data(c,new a($(this),t))})};var a=function(i,t){if(i){1==i.nodeType&&(i=$(i));var a={data:"auto",max:8,width:"auto",container:$(document.body),filter:function(t,e){var i=[];return $.isArray(t)&&$.each(t,function(t,a){""!=e&&0!=a.value.indexOf(e)||i.push(a)}),i},trigger:["change"],onShow:$.noop,onHide:$.noop};t=t||{};var e=i.attr("results");e&&(t.max=+e);var r=$.extend({},a,t),s=this;if(s.el={input:i,trigger:i,container:r.container},s.callback={trigger:r.trigger,filter:r.filter,show:r.onShow,hide:r.onHide},s.params={width:r.width,max:r.max,data:r.data,index:-1},this.bool={modern:"oninput"in document.createElement("div")},s.display=!1,"auto"==r.data){var l=i.attr("name"),n=i.attr("autocomplete");l&&"off"!=n&&i.attr("autocomplete","off"),this.callback.data=function(){var e=[];if(window.localStorage&&l&&"off"!=n){var t=localStorage[c+"-"+l];t&&$.each(t.split(","),function(t,a){a&&e.push({label:"",value:a})})}return e},i.parents("form").on("submit",function(){s.store()})}else if($.isArray(r.data))this.callback.data=function(){return r.data};else if($.isFunction(r.data))this.callback.data=r.data;else if($.isPlainObject(r.data)&&r.data.url){i.attr("autocomplete","off"),t.filter||(s.callback.filter=function(t){return t});var o=r.data.success;this.callback.data=function(){clearTimeout(s.ajaxTimer);var a=$.extend({},{dataType:"json"},r.data);a.data=a.data||{};var t=i.attr("name")||"k",e=$.trim(i.val());if(""==e)return s.data=[],[];a.data[t]=e,a.success=function(t){o&&o.apply(a,arguments),t&&$.isArray(t.data)&&s.refresh(s.callback.filter.call(s,t.data))},s.ajaxTimer=setTimeout(function(){$.ajax(a)},200)}}this.events()}else window.console&&window.console.error("Datalist实例方法参数缺失")};return a.prototype.store=function(){var t=this.el.trigger,a=this.value(),e=t.attr("name");if(window.localStorage&&"auto"==this.params.data&&a&&e){var i=(localStorage[c+"-"+e]||"").split(","),r=$.inArray(a,i);if(-1==r)i.unshift(a);else if(0!=r){i=i.splice(r,1).concat(i)}localStorage[c+"-"+e]=i.join()}return this},a.prototype.removeStore=function(t){var a=this.el.trigger.attr("name");if(t=t||this.value(),window.localStorage&&"auto"==this.params.data&&a&&t)if(!0===t)localStorage.removeItem(c+"-"+a);else if("string"==typeof t){var e=(localStorage[c+"-"+a]||"").split(","),i=$.inArray(t,e);-1!=i&&(e.splice(i,1),localStorage[c+"-"+a]=e.join())}return this},a.prototype.refresh=function(t){var s=this,a=this.el.target;a||(this.create(),a=this.el.target);var l=this.value();if(void 0===t&&(t=this.callback.filter.call(this,this.callback.data(),l),0==$.isArray(t)))return this;"number"==typeof this.params.max&&(t=t.slice(0,this.params.max)),this.data=t;var n="";if(t&&t.length&&(s.params.index=-1,$.each(t,function(t,a){var e=$.trim($.stripHTML(a.value||"")),i=$.trim($.stripHTML(a.label||"")),r="";l&&e==l&&(r=" "+o,s.params.index=t),n=a.label?n+'<li class="'+u+"-option"+r+'" value="'+e+'" label="'+i+'" data-index="'+t+'"><label class="'+u+'-label">'+a.label+'</label><span class="'+u+'-value">'+a.value+"</span></li>":n+'<li class="'+u+"-option"+r+'" value="'+e+'" data-index="'+t+'"><span class="'+u+'-value">'+a.value+"</span></li>"})),""!=n&&(n='<ul class="'+u+'-datalist">'+n+"</ul>"),a.html(n),n?0==this.display&&this.show():1==this.display&&this.hide(),1==this.display){var e=a.find("."+o)[0];e&&$(e).parent().scrollTop(e.offsetTop)}},a.prototype.create=function(){var a=this,t=this.el.trigger;if(!this.el.target){var e=t.attr("list");e||(e=c+(Math.random()+"").split(".")[1],t.attr("list",e));var i=$('<div id="'+e+'">').addClass(u).on("click","li",function(){var t=$(this).attr("value");a.value(t),a.hide()});t.attr("id")&&i.addClass(c+"-"+t.attr("id").toLowerCase()),a.el.container.append(i),this.el.target=i,this.display=!1}return this},a.prototype.value=function(t){var e=this.el.trigger,a=this.callback.trigger,i="input";return void 0===t?$.encodeHTML($.trim(e.val())):(e.val($.decodeHTML($.trim(t+""))),t&&a&&(this.bool.modern?$.isArray(a)?-1==$.inArray(i,a)&&a.push(i):a=a&&"string"==typeof a&&a!=i?[i,a]:[i]:0==$.isArray(a)&&(a=[a]),$.each(a,function(t,a){e.trigger(a)})),this)},a.prototype.events=function(){var l=this,i=this.el.trigger;i.on({blur:function(){$(this).data("focus",!1)},click:function(){0!=l.display||1!=$(this).data("focus")||"auto"!=l.params.data&&!$.trim(this.value)||l.refresh(),$(this).data("focus",!0)},input:function(t){t.isTrigger||($.trim(this.value)?l.refresh():l.hide())},keydown:function(t){var a=l.data,e=l.params.index;switch(t.keyCode){case 27:case 13:1==l.display&&(l.hide(),t.preventDefault(),this.value&&l.el.target.find("."+o).length&&(t.preventDefault(),setTimeout(function(){var a=t.target;if(a.setSelectionRange)try{a.setSelectionRange(a.value.length,a.value.length)}catch(t){a.value=a.value}else a.value=a.value;n&&$(a).trigger("input")},17)));break;case 38:1==l.display&&a&&a.length&&--e<0&&(e=a.length-1);break;case 40:1==l.display&&a&&a.length&&++e>a.length-1&&(e=0);break;case 46:if(1==l.display&&"auto"==l.params.data){var i=l.el.target.find("."+o);if(i.length){var r=i.attr("value");l.removeStore(r),a=$.grep(a,function(t){return t.value!=r}),t.preventDefault(),$(this).data("stopPropertyChange",!0);var s=a[e]||a[e-1];s?(l.value($.stripHTML(s.value)),l.refresh(a)):(this.value="",l.hide())}}}38!=t.keyCode&&40!=t.keyCode||(t.preventDefault(),$(this).data("stopPropertyChange",!0),a[e]&&l.value($.stripHTML(a[e].value)),$(this).select(),l.refresh(a))}});var n=this.bool.modern;return i.length&&0==n&&i[0].attachEvent("onpropertychange",function(t){t&&"value"==t.propertyName&&!i.data("stopPropertyChange")&&($.trim(i.val())?l.refresh():l.hide()),$(this).data("stopPropertyChange",!1)}),$(document).mouseup(function(t){var a=t.target,e=l.el.target;a&&e&&a!=i[0]&&a!=e[0]&&0==e[0].contains(a)&&l.hide()}),$(window).resize(function(){1==l.display&&l.position()}),this},a.prototype.position=function(){var t=this.el.trigger,a=this.el.target;return t&&a&&(a.follow(t,{edgeAdjust:!1}),1==this.display&&t.addClass(e)),this},a.prototype.show=function(){var t=this.el.trigger,a=this.el.target;a||(this.create(),a=this.el.target);var e=this.display,i=this.params.width;"auto"==i?i=t.outerWidth():$.isFunction(i)&&(i=i.call(this,t,a)),"auto"!=i&&"number"!=typeof i&&(i=t.width()),a.css({display:"block",width:i}),this.display=!0,this.position(),0==e&&this.callback.show.call(this,t,a)},a.prototype.hide=function(){var t=this.el.trigger,a=this.el.target;a&&1==this.display&&(a.hide().removeClass(i),this.callback.hide.call(this,t,a)),t.removeClass(e).removeClass(i),this.display=!1},a});