!function(t,e){"function"==typeof define&&(define.amd||define.cmd)?define(e):t.Select=e()}(this,function(t){"function"==typeof t&&t("enhance");var c="selected",h="disabled",l="active",d="reverse",e="coo-",u=e+"select",f=e.replace(/[a-z]/gi,"");$.fn.selectMatch=function(){return $(this).each(function(){var t=$(this);t.data("select")?t.data("select").refresh():new a(t)})};var a=function(t){if(t){t.length||(t=$(t));var e=t[0].id;e=e||("id_"+Math.random()).replace("0.",""),this.id=e;var a=t.prop("multiple");this.multiple=a;var s=$("<div></div>").attr({role:"combobox"}),i=$("<a></a>").attr({href:"javascript:","data-target":e,role:"button","aria-expanded":"false","aria-owns":e}).addClass(u+f+"button"),o=$("<div></div>").attr({id:e,role:"listbox","aria-expanded":"true"}).addClass(u+f+"datalist");a?(s.append(o),t.css({position:"absolute",zIndex:1}).after(s),o.attr("aria-hidden","true")):(s.append(i).append(o),t.hide().after(s)),this.el={sel:t,combobox:s,button:i,datalist:o},this.refresh(),this.events(),t.data("select",this)}else window.console&&window.console.error("Select实例方法参数缺失")};return a.prototype.events=function(){var s=this,t=s.el,i=t.sel,o=t.combobox,n=t.button,r=t.datalist;this.multiple?(i.on("change",function(){s.refresh()}),i.on("scroll",function(){r.scrollTop(i.scrollTop())}),i.on("mousedown",function(){i.data(l,"true")}).on("mousemove",function(t){if(i.data(l))s.refresh();else{var a=t.clientY,e=r.find("a");e.removeAttr("href"),e.each(function(){var t=this.getBoundingClientRect().top,e=t+this.clientHeight;if(t<=a&&a<=e)return 0==$(this).hasClass(c)&&(this.href="javascript:"),!1})}}).on("mouseout",function(){r.find("a").removeAttr("href")}),$(document).on("mouseup",function(){i.removeData(l)})):(n.on("click",function(){if(i.prop(h))return!1;if(o.toggleClass(l),o.hasClass(l)){var t=r.offset().top+r.outerHeight()>Math.max($(document.body).height(),$(window).height());o[t?"addClass":"removeClass"](d),n.attr("aria-expanded","true");var e=o.data("scrollTop"),a=r.find("."+c);e&&e[1]==a.attr("data-index")&&e[2]==a.text()&&(r.scrollTop(e[0]),o.removeData("scrollTop"))}else o.removeClass(d),n.attr("aria-expanded","false")}),r.on("click","a[data-index]",function(){var t=$(this).hasClass(h),e=$(this).data("index"),a=r.scrollTop();o.data("scrollTop",[a,e,$(this).text()]),0==t&&(i.find("option")[e][c]=!0),o.removeClass(l),n.attr("aria-expanded","false"),n.focus().blur(),0==t&&(s.refresh(),i.trigger("change"))}),$(document).on("mouseup",function(t){var e=t.target;e&&o.hasClass(l)&&o[0]!==e&&0==o[0].contains(e)&&o.removeClass(l).removeClass(d)}))},a.prototype.getData=function(){var t=this.el.sel.find("option");return 0==t.length?[{html:""}]:t.map(function(){var t=this;return{html:t.innerHTML,value:t.value,selected:t.selected,disabled:t.disabled,className:t.className}})},a.prototype.refresh=function(t){var a,e=this,s=e.id,i=e.multiple,o=e.el,n=o.sel,r=o.combobox,l=o.button,d=o.datalist;return t=t||e.getData(),r.attr("class",$.trim(n[0].className+" "+u)).width(n.outerWidth()),i?r.height(n.outerHeight()):l.html('<span class="'+u+f+'text">'+(a="",$.each(t,function(t,e){e.selected&&(a=e.html)}),a||t[0].html)+'</span><i class="'+u+f+'icon" aria-hidden="true"></i>'),d.html($.map(t,function(t,e){var a=[u+f+"datalist"+f+"li",t.className];return t[c]&&a.push(c),t[h]&&a.push(h),i?'<a class="'+a.join(" ")+'" data-index='+e+">"+t.html+"</a>":"<a "+(t[h]?"":'href="javascript:" ')+'class="'+a.join(" ")+'" data-index='+e+' data-target="'+s+'" role="option" aria-selected="'+t[c]+'">'+t.html+"</a>"}).join("")),this},a});